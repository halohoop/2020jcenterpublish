/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Kotlin library project to get you started.
 */

plugins {
    // Apply the Kotlin JVM plugin to add support for Kotlin.
    id 'org.jetbrains.kotlin.jvm' version '1.3.71'

    // Apply the java-library plugin for API and implementation separation.
    id 'java-library'

    id 'com.jfrog.bintray' version '1.8.5'
    id 'org.jetbrains.dokka' version '0.10.1'
    id 'maven-publish'
}

repositories {
    // Use jcenter for resolving dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
}

dependencies {
    // Align versions of all Kotlin components
    implementation platform('org.jetbrains.kotlin:kotlin-bom')

    // Use the Kotlin JDK 8 standard library.
    implementation 'org.jetbrains.kotlin:kotlin-stdlib-jdk8'

    // Use the Kotlin test library.
    testImplementation 'org.jetbrains.kotlin:kotlin-test'

    // Use the Kotlin JUnit integration.
    testImplementation 'org.jetbrains.kotlin:kotlin-test-junit'
}

task dokkaJavadoc(type: org.jetbrains.dokka.gradle.DokkaTask) {
    outputFormat = 'javadoc'
    outputDirectory = "$buildDir/javadoc"
    inputs.dir "src/main/kotlin"
}

task javadocJar(type: Jar, dependsOn: dokkaJavadoc) {
    from "$buildDir/javadoc"
//    classifier = 'javadoc'
    archiveClassifier.set("javadoc")
}

task sourcesJar(type: Jar) {
    from "src"
    archiveClassifier.set("sources")
}

bintray {
    user = 'halohoop'
    //./gradlew -PapiKey="blablablablablablabla"
    key = "${project.hasProperty('apiKey') ? project.apiKey : ""}"
    override = true
    publish = true
    pkg {
        repo = 'maven'
        name = project.name
        userOrg = user
        licenses = ['Apache-2.0']
        vcsUrl = "halohoop.com"
        issueTrackerUrl = "halohoop.com"
        version {
            name = '0.0.1'
            desc = "javaLibraryJarKotlin 0.0.1 final"
            released = new Date()
            vcsTag = '0.0.1'
//            attributes = ['gradle-plugin': 'com.use.less:com.use.less.gradle:gradle-useless-plugin']
        }
    }
    //https://github.com/bintray/bintray-examples/tree/master/gradle-bintray-plugin-examples/publications-example
    publications = ['MyPublication']
}

publishing {
    publications {
        MyPublication(MavenPublication) {
            artifact (jar)
//            artifact "${buildDir}/libs/lib-simpleloginet-javadoc.jar"//文件的话不能够直接几个不同后缀名的一起上传
//            artifact "${buildDir}/libs/lib-simpleloginet-sources.jar"//文件的话不能够直接几个不同后缀名的一起上传
            artifact(sourcesJar)
            artifact(javadocJar)
            groupId "com.halohoop"
            artifactId 'javalibraryjarkotlin'
            version '0.0.1'
        }
//        repositories {
//            maven {
//                url "$buildDir/repo"
//            }
//        }
    }
}